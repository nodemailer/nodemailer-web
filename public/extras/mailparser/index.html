<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="description" content="Nodemailer is a module for Node.js to send emails">
<meta name="author" content="Andris Reinman">

    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <title>Mailparser :: Nodemailer</title>

    
    <link href="/css/nucleus.css?1725525815" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1725525815" rel="stylesheet">
    <link href="/css/hybrid.css?1725525815" rel="stylesheet">
    <link href="/css/featherlight.min.css?1725525815" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1725525815" rel="stylesheet">
    <link href="/css/auto-complete.css?1725525815" rel="stylesheet">
    <link href="/css/theme.css?1725525815" rel="stylesheet">
    <link href="/css/hugo-theme.css?1725525815" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1725525815" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1725525815"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <style>
  #sidebar #header-wrapper {
    background-color: white;
  }
  #sidebar #header-wrapper a {
    color: #07689f;
  }

  #ads {
     
    max-width: 260px;
     
    margin: 3px auto 10px auto;
     
    font-size: 13px;
    color: #07689f;
  }

  #carbonads * {
    margin: initial;
    padding: initial;
  }
  #carbonads {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
  }
  #carbonads {
    display: flex;
    max-width: 330px;
    background-color: hsl(0, 0%, 98%);
    box-shadow: 0 1px 4px 1px hsla(0, 0%, 0%, 0.1);
    z-index: 100;
  }
  #carbonads a {
    color: inherit;
    text-decoration: none;
  }
  #carbonads a:hover {
    color: inherit;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  #carbonads .carbon-wrap {
    display: flex;
  }
  #carbonads .carbon-img {
    display: block;
    margin: 0;
    line-height: 1;
  }
  #carbonads .carbon-img img {
    display: block;
  }
  #carbonads .carbon-text {
    font-size: 13px;
    padding: 10px;
    margin-bottom: 16px;
    line-height: 1.5;
    text-align: left;
  }
  #carbonads .carbon-poweredby {
    display: block;
    padding: 6px 8px;
    background: #f1f1f2;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    font-size: 8px;
    line-height: 1;
    border-top-left-radius: 3px;
    position: absolute;
    bottom: 0;
    right: 0;
  }

  #chapter p {
    text-align: left;
  }

  code {
    line-height: 1.5rem;
  }
</style>

<script defer data-domain="nodemailer.com" src="https://plausible.emailengine.dev/js/script.js"></script>
<script defer src="https://postalsys.com/frame.js"></script>

  </head>
  <body class="" data-url="/extras/mailparser/">
    <nav id="sidebar" class="">
   
  <div id="header-wrapper">
    <div id="header"><a id="logo" href="https://nodemailer.com">
  <img src="/nm_logo_200x136.png" alt="Nodemailer" />
</a>
</div>
     <p>
  <a href="https://emailengine.app/?utm_source=nodemailer&amp;utm_campaign=nodemailer&amp;utm_medium=header-link">Powered by <b>EmailEngine</b></a>
</p>
 
  </div>

  <div class="highlightable">
    
    

    

    
    

    <div
      style="
        max-width: 260px;
        margin: 3px auto 16px auto;
        font-size: 13px;
        color: #407ec9;
        background-color: hsl(0, 0%, 98%);
        box-shadow: 0 1px 4px 1px hsla(0, 0%, 0%, 0.1);
      "
    >
      <a
        href="https://emailengine.app/?utm_source=nodemailer&utm_campaign=nodemailer&utm_medium=sidebar"
        style="
          display: inline-block;
          color: #407ec9;
          text-decoration: none;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Helvetica, Arial, sans-serif;
        "
      >
        <div style="display: flex; align-items: center; gap: 5px; width: 100%; background: white" target="_blank">
          <div style="flex-basis: 50%">
            <img src="/EmailEngine_logo_vert.png" style="width: 130px" />
          </div>
          <div style="flex-basis: 50%">
            <div style="font-size: 13px; line-height: 1.5; text-align: left">Send and receive emails easily with Outlook and Gmail using OAuth2.</div>
          </div>
        </div>
      </a>
    </div>

    <ul class="topics">
             
<li
  data-nav-id="/about/"
  title="Nodemailer"
  class="dd-item
        
        
        
        "
>
  <a href="/about/">
    <b>1. </b>Nodemailer 
  </a>
   
  <ul>
               
<li data-nav-id="/about/migrate/" title="Migration" class="dd-item ">
  <a href="/about/migrate/">
    Migration 
  </a>
</li>
            
<li data-nav-id="/about/license/" title="License" class="dd-item ">
  <a href="/about/license/">
    License 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/usage/"
  title="Usage"
  class="dd-item
        
        
        
        "
>
  <a href="/usage/">
    <b>2. </b>Usage 
  </a>
   
  <ul>
               
<li data-nav-id="/usage/why-smtp/" title="SMTP? Say what?" class="dd-item ">
  <a href="/usage/why-smtp/">
    SMTP? Say what? 
  </a>
</li>
            
<li data-nav-id="/usage/using-gmail/" title="Using Gmail" class="dd-item ">
  <a href="/usage/using-gmail/">
    Using Gmail 
  </a>
</li>
            
<li data-nav-id="/usage/bulk-mail/" title="Delivering bulk mail" class="dd-item ">
  <a href="/usage/bulk-mail/">
    Delivering bulk mail 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/message/"
  title="Message configuration"
  class="dd-item
        
        
        
        "
>
  <a href="/message/">
    <b>3. </b>Message configuration 
  </a>
   
  <ul>
               
<li data-nav-id="/message/attachments/" title="Attachments" class="dd-item ">
  <a href="/message/attachments/">
    Attachments 
  </a>
</li>
            
<li data-nav-id="/message/alternatives/" title="Alternatives" class="dd-item ">
  <a href="/message/alternatives/">
    Alternatives 
  </a>
</li>
            
<li data-nav-id="/message/addresses/" title="Address object" class="dd-item ">
  <a href="/message/addresses/">
    Address object 
  </a>
</li>
            
<li data-nav-id="/message/calendar-events/" title="Calendar events" class="dd-item ">
  <a href="/message/calendar-events/">
    Calendar events 
  </a>
</li>
            
<li data-nav-id="/message/embedded-images/" title="Embedded images" class="dd-item ">
  <a href="/message/embedded-images/">
    Embedded images 
  </a>
</li>
            
<li data-nav-id="/message/list-headers/" title="List headers" class="dd-item ">
  <a href="/message/list-headers/">
    List headers 
  </a>
</li>
            
<li data-nav-id="/message/custom-headers/" title="Custom headers" class="dd-item ">
  <a href="/message/custom-headers/">
    Custom headers 
  </a>
</li>
            
<li data-nav-id="/message/custom-source/" title="Custom source" class="dd-item ">
  <a href="/message/custom-source/">
    Custom source 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/smtp/"
  title="SMTP transport"
  class="dd-item
        
        
        
        "
>
  <a href="/smtp/">
    <b>4. </b>SMTP transport 
  </a>
   
  <ul>
               
<li data-nav-id="/smtp/envelope/" title="SMTP envelope" class="dd-item ">
  <a href="/smtp/envelope/">
    SMTP envelope 
  </a>
</li>
            
<li data-nav-id="/smtp/pooled/" title="Pooled SMTP" class="dd-item ">
  <a href="/smtp/pooled/">
    Pooled SMTP 
  </a>
</li>
            
<li data-nav-id="/smtp/testing/" title="Testing SMTP" class="dd-item ">
  <a href="/smtp/testing/">
    Testing SMTP 
  </a>
</li>
            
<li data-nav-id="/smtp/oauth2/" title="OAuth2" class="dd-item ">
  <a href="/smtp/oauth2/">
    OAuth2 
  </a>
</li>
            
<li data-nav-id="/smtp/customauth/" title="Custom authentication" class="dd-item ">
  <a href="/smtp/customauth/">
    Custom authentication 
  </a>
</li>
            
<li data-nav-id="/smtp/proxies/" title="Proxy support" class="dd-item ">
  <a href="/smtp/proxies/">
    Proxy support 
  </a>
</li>
            
<li data-nav-id="/smtp/dsn/" title="Delivery status notifications" class="dd-item ">
  <a href="/smtp/dsn/">
    Delivery status notifications 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/transports/"
  title="Other transports"
  class="dd-item
        
        
        
        "
>
  <a href="/transports/">
    <b>5. </b>Other transports 
  </a>
   
  <ul>
               
<li data-nav-id="/transports/sendmail/" title="Sendmail transport" class="dd-item ">
  <a href="/transports/sendmail/">
    Sendmail transport 
  </a>
</li>
            
<li data-nav-id="/transports/ses/" title="SES transport" class="dd-item ">
  <a href="/transports/ses/">
    SES transport 
  </a>
</li>
            
<li data-nav-id="/transports/stream/" title="Stream transport" class="dd-item ">
  <a href="/transports/stream/">
    Stream transport 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/plugins/"
  title="Plugins"
  class="dd-item
        
        
        
        "
>
  <a href="/plugins/">
    <b>6. </b>Plugins 
  </a>
   
  <ul>
               
<li data-nav-id="/plugins/create/" title="Create plugins" class="dd-item ">
  <a href="/plugins/create/">
    Create plugins 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/dkim/"
  title="DKIM"
  class="dd-item
        
        
        
        "
>
  <a href="/dkim/">
    <b>7. </b>DKIM 
  </a>
   
</li>
         
<li
  data-nav-id="/extras/"
  title="Extra modules"
  class="dd-item
        parent
        
        
        "
>
  <a href="/extras/">
    <b>8. </b>Extra modules 
  </a>
   
  <ul>
               
<li data-nav-id="/extras/smtp-server/" title="SMTP Server" class="dd-item ">
  <a href="/extras/smtp-server/">
    SMTP Server 
  </a>
</li>
            
<li data-nav-id="/extras/smtp-connection/" title="SMTP Connection" class="dd-item ">
  <a href="/extras/smtp-connection/">
    SMTP Connection 
  </a>
</li>
            
<li data-nav-id="/extras/mailparser/" title="Mailparser" class="dd-item active">
  <a href="/extras/mailparser/">
    Mailparser 
  </a>
</li>
            
<li data-nav-id="/extras/mailcomposer/" title="Mailcomposer" class="dd-item ">
  <a href="/extras/mailcomposer/">
    Mailcomposer 
  </a>
</li>
            
<li data-nav-id="/extras/daemons/" title="Node.js daemons" class="dd-item ">
  <a href="/extras/daemons/">
    Node.js daemons 
  </a>
</li>
      
  </ul>
  
</li>
         
<li
  data-nav-id="/app/"
  title="NodemailerApp"
  class="dd-item
        
        
        
        "
>
  <a href="/app/">
    <b>9. </b>NodemailerApp 
  </a>
   
</li>
    
    </ul>

      
    <section id="footer"><div style="text-align: center; margin-bottom:10px;">
    <form
        action="https://www.paypal.com/cgi-bin/webscr"
        method="post"
        target="_top"
    >
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="DB26KWR2BQX5W" />
        <input
            type="image"
            src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif"
            border="0"
            name="submit"
            alt="PayPal - The safer, easier way to pay online!"
            style="display: inline"
        />
        <img
            alt=""
            border="0"
            src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif"
            width="1"
            height="1"
        />
    </form>
</div>
</section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Nodemailer</a> > <a href='/extras/'>Extra modules</a> > Mailparser
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#install">Install</a></li>
    <li><a href="#simpleparser">simpleParser</a>
      <ul>
        <li><a href="#mail-object">mail object</a></li>
        <li><a href="#address-object">address object</a></li>
        <li><a href="#headers-map">headers Map</a></li>
        <li><a href="#attachment-object">attachment object</a></li>
      </ul>
    </li>
    <li><a href="#mailparser">MailParser</a>
      <ul>
        <li><a href="#options">options</a></li>
        <li><a href="#event-headers">Event &lsquo;headers&rsquo;</a></li>
        <li><a href="#event-data">Event &lsquo;data&rsquo;</a></li>
        <li><a href="#attachment-object-1">attachment object</a></li>
        <li><a href="#text-object">text object</a></li>
      </ul>
    </li>
    <li><a href="#issues">Issues</a></li>
    <li><a href="#license">License</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Mailparser</h1>
          

        


<p>Advanced email parser for Node.js. Everything is handled as a stream which should make it able to parse even very large messages (100MB+) with relatively low overhead.</p>
<p>The module exposes two separate modes, a lower level <strong>MailParser</strong> class and <strong>simpleParser</strong> function. The latter is simpler to use (hence the name) but is less resource efficient as it buffers attachment contents in memory.</p>
<h2 id="install">Install</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm install mailparser --save
</code></pre></div><h2 id="simpleparser">simpleParser</h2>
<p><strong>simpleParser</strong> is the easiest way to parse emails. You only need to provide a message source to get a parsed email structure in return. As an additional bonus all embedded images in HTML (eg. the images that point to attachments using cid: URIs) are replaced with base64 encoded data URIs, so the message can be displayed without any additional processing. Be aware though that this module does not do any security cleansing (eg. removing javascript and so on), this is left to your own application.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">simpleParser</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;mailparser&#39;</span>).<span style="color:#a6e22e">simpleParser</span>;
<span style="color:#a6e22e">simpleParser</span>(<span style="color:#a6e22e">source</span>, <span style="color:#a6e22e">options</span>, (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">parsed</span>) =&gt; {});
</code></pre></div><p>See <code>MailParser</code> <a href="#options">options</a> list</p>
<p>or as a Promise:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">simpleParser</span>(<span style="color:#a6e22e">source</span>, <span style="color:#a6e22e">options</span>)
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">parsed</span> =&gt; {})
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; {});
</code></pre></div><p>or even with async..await:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">parsed</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">simpleParser</span>(<span style="color:#a6e22e">source</span>);
</code></pre></div><p>Where</p>
<ul>
<li><strong>source</strong> is either a stream, a Buffer or a string that needs to be parsed</li>
<li><strong>options</strong> is an optional options object</li>
<li><strong>err</strong> is the possible error object</li>
<li><strong>mail</strong> is a structured email object</li>
</ul>
<h3 id="mail-object">mail object</h3>
<p>Parsed <strong>mail*</strong> object has the following properties</p>
<ul>
<li><strong>headers</strong> – a Map object with lowercase header keys</li>
<li><strong>subject</strong> is the subject line (also available from the header <em>mail.headers.get(&lsquo;subject&rsquo;)</em>)</li>
<li><strong>from</strong> is an address object for the From: header</li>
<li><strong>to</strong> is an address object for the To: header</li>
<li><strong>cc</strong> is an address object for the Cc: header</li>
<li><strong>bcc</strong> is an address object for the Bcc: header (usually not present)</li>
<li><strong>date</strong> is a Date object for the Date: header</li>
<li><strong>messageId</strong> is the Message-ID value string</li>
<li><strong>inReplyTo</strong> is the In-Reply-To value string</li>
<li><strong>reply-to</strong> is an address object for the Cc: header</li>
<li><strong>references</strong> is an array of referenced Message-ID values</li>
<li><strong>html</strong> is the HTML body of the message. If the message included embedded images as cid: urls then these are all replaced with base64 formatted data: URIs</li>
<li><strong>text</strong> is the plaintext body of the message</li>
<li><strong>textAsHtml</strong> is the plaintext body of the message formatted as HTML</li>
<li><strong>attachments</strong> is an array of attachments</li>
</ul>
<h3 id="address-object">address object</h3>
<p>Address objects have the following structure:</p>
<ul>
<li>
<p><strong>value</strong> an array with address details</p>
<ul>
<li><strong>name</strong> is the name part of the email/group</li>
<li><strong>address</strong> is the email address</li>
<li><strong>group</strong> is an array of grouped addresses</li>
</ul>
</li>
<li>
<p><strong>text</strong> is a formatted address string for plaintext context</p>
</li>
<li>
<p><strong>html</strong> is a formatted address string for HTML context</p>
</li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
    <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> [
        {
            <span style="color:#a6e22e">address</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;andris+123@kreata.ee&#39;</span>,
            <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Andris Reinman&#39;</span>
        },
        {
            <span style="color:#a6e22e">address</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;andris.reinman@gmail.com&#39;</span>,
            <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>
        }
    ],
    <span style="color:#a6e22e">html</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;span class=&#34;mp_address_name&#34;&gt;Andris Reinman&lt;/span&gt; &lt;&lt;a href=&#34;mailto:andris+123@kreata.ee&#34; class=&#34;mp_address_email&#34;&gt;andris+123@kreata.ee&lt;/a&gt;&gt;, &lt;a href=&#34;mailto:andris.reinman@gmail.com&#34; class=&#34;mp_address_email&#34;&gt;andris.reinman@gmail.com&lt;/a&gt;&#39;</span>,
    <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Andris Reinman &lt;andris+123@kreata.ee&gt;, andris.reinman@gmail.com&#39;</span>
}
</code></pre></div><h3 id="headers-map">headers Map</h3>
<p><strong>headers</strong> is a Map with lowercase header keys. So if you want to check for the Subject: header then you can do it like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">headers</span>.<span style="color:#a6e22e">has</span>(<span style="color:#e6db74">&#39;subject&#39;</span>)) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">headers</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;subject&#39;</span>));
}
</code></pre></div><p>The format of a header depends on the specific key. For most header keys the value is either a string (a single header) or an array of strings (multiple headers with the same key were found).</p>
<p>Special header keys are the following:</p>
<ol>
<li>All address headers are converted into address objects</li>
</ol>
<ul>
<li><strong>from</strong></li>
<li><strong>to</strong></li>
<li><strong>cc</strong></li>
<li><strong>bcc</strong></li>
<li><strong>sender</strong></li>
<li><strong>reply-to</strong></li>
<li><strong>delivered-to</strong></li>
<li><strong>return-path</strong></li>
</ul>
<ol start="2">
<li>All different priority headers are converted into <strong>priority</strong> with the following values:</li>
</ol>
<ul>
<li><strong>&lsquo;high&rsquo;</strong></li>
<li><strong>&lsquo;normal&rsquo;</strong></li>
<li><strong>&lsquo;low&rsquo;</strong></li>
</ul>
<ol start="3">
<li>
<p><strong>references</strong> is a string if only a single reference-id exists or an array if multiple ids exist</p>
</li>
<li>
<p><strong>date</strong> value is a Date object</p>
</li>
<li>
<p>The following headers are parsed into structured objects, where <em>value</em> property includes the main value as string and <em>params</em> property holds an object of additional arguments as key-value pairs</p>
</li>
</ol>
<ul>
<li><strong>content-type</strong></li>
<li><strong>content-disposition</strong></li>
<li><strong>dkim-signature</strong></li>
</ul>
<p>Some headers are also automaticaly mime-word decoded</p>
<ul>
<li>all address headers (name parts and punycode encoded domains are converted to unicode)</li>
<li><strong>subject</strong> is converted to unicode</li>
</ul>
<h3 id="attachment-object">attachment object</h3>
<p>Attachment objects have the following structure:</p>
<ul>
<li><strong>filename</strong> (if available) file name of the attachment</li>
<li><strong>contentType</strong> MIME type of the message</li>
<li><strong>contentDisposition</strong> content disposition type for the attachment, most probably &ldquo;attachment&rdquo;</li>
<li><strong>checksum</strong> a MD5 hash of the message content</li>
<li><strong>size</strong> message size in bytes</li>
<li><strong>headers</strong> a Map value that holds MIME headers for the attachment node</li>
<li><strong>content</strong> a Buffer that contains the attachment contents</li>
<li><strong>contentId</strong> the header value from &lsquo;Content-ID&rsquo; (if present)</li>
<li><strong>cid</strong> contentId without &lt; and &gt;</li>
<li><strong>related</strong> if true then this attachment should not be offered for download (at least not in the main attachments list)</li>
</ul>
<h2 id="mailparser">MailParser</h2>
<p><strong>MailParser</strong> is a lower-level email parsing class. It is a transform stream that takes email source as bytestream for the input and emits data objects for attachments and text contents.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">MailParser</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;mailparser&#39;</span>).<span style="color:#a6e22e">MailParser</span>;
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">parser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MailParser</span>();
</code></pre></div><h3 id="options">options</h3>
<ul>
<li><strong>skipHtmlToText</strong> <code>boolean</code> Don&rsquo;t generate plaintext from HTML. Defaults to <code>undefined</code> (<em>falsy</em>).</li>
<li><strong>maxHtmlLengthToParse</strong> <code>number</code> The maximum amount of HTML to parse in bytes. Defaults to <code>undefined</code> (<em>Infinity</em>).</li>
<li><strong>formatDateString</strong> <code>function</code> Provide a custom formatting function. Defaults to <code>undefined</code>.</li>
<li><strong>skipImageLinks</strong> <code>boolean</code> Skip converting CID attachments to data URL images. Defaults to <code>undefined</code> (<em>falsy</em>).</li>
<li><strong>skipTextToHtml</strong> <code>boolean</code> Don&rsquo;t generate HTML from plaintext message. Defaults to <code>undefined</code> (<em>falsy</em>).</li>
<li><strong>skipTextLinks</strong> <code>boolean</code> Do not linkify links in plaintext content. Defaults to <code>undefined</code> (<em>falsy</em>).</li>
<li><strong>keepDeliveryStatus</strong> <code>boolean</code> Do not consider attachments of type <code>message/delivery-status</code> as text but as a separate attachment. Useful for parsing delivery status notifications. Defaults to <code>undefined</code> (<em>falsy</em>).</li>
<li><strong>Iconv</strong> <code>object</code> Defaults to <a href="https://www.npmjs.com/package/iconv-lite">iconv-lite</a></li>
<li><strong>keepCidLinks</strong> <code>boolean</code> <code>simpleParser</code>-only option. Sets <code>skipImageLinks</code> to true.</li>
</ul>
<h3 id="event-headers">Event &lsquo;headers&rsquo;</h3>
<p>The parser emits &lsquo;headers&rsquo; once message headers have been processed. The headers object is a Map. Different header keys have different kind of values, for example address headers have the address object/array as the value while subject value is string.</p>
<p>Header keys in the Map are lowercase.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;headers&#39;</span>, <span style="color:#a6e22e">headers</span> =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">headers</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;subject&#39;</span>));
});
</code></pre></div><h3 id="event-data">Event &lsquo;data&rsquo;</h3>
<p>Event &lsquo;data&rsquo; or &lsquo;readable&rsquo; emits message content objects. The type of the object can be determine by the <em>type</em> property. Currently there are two kind of data objects</p>
<ul>
<li>&lsquo;attachment&rsquo; indicates that this object is an attachment</li>
<li>&lsquo;text&rsquo; indicates that this object includes the html and text parts of the message. This object is emitted once and it includes both values</li>
</ul>
<h3 id="attachment-object-1">attachment object</h3>
<p>Attachment object is the same as in <em>simpleParser</em> except that <em>content</em> is not a buffer but a stream. Additionally there&rsquo;s a method <strong>release()</strong> that must be called once you have processed the attachment. The property <em>related</em> is set after message processing is ended, so at the <em>data</em> event this value is not yet available.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;data&#39;</span>, <span style="color:#a6e22e">data</span> =&gt; {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;attachment&#39;</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">filename</span>);
        <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">pipe</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">stdout</span>);
        <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;end&#39;</span>, () =&gt; <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">release</span>());
    }
});
</code></pre></div><p>If you do not call <strong>release()</strong> then the message processing is paused.</p>
<h3 id="text-object">text object</h3>
<p>Text object has the following keys:</p>
<ul>
<li><strong>text</strong> includes the plaintext version of the message. Is set if the message has at least one &lsquo;text/plain&rsquo; node</li>
<li><strong>html</strong> includes the HTML version of the message. Is set if the message has at least one &lsquo;text/html&rsquo; node</li>
<li><strong>textAsHtml</strong> includes the plaintext version of the message in HTML format. Is set if the message has at least one &lsquo;text/plain&rsquo; node.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;data&#39;</span>, <span style="color:#a6e22e">data</span> =&gt; {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;text&#39;</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">html</span>);
    }
});
</code></pre></div><h2 id="issues">Issues</h2>
<p>Charset decoding is handled using <a href="https://github.com/ashtuchkin/iconv-lite">iconv-lite</a>, except for ISO-2022-JP and EUCJP that are handled by <a href="https://www.npmjs.com/package/encoding-japanese">encoding-japanese</a>. Alternatively you can use <a href="https://www.npmjs.com/package/iconv">node-iconv</a> module instead for all charset decoding. This module is not included in the mailparser package, you would have to provide it to Mailparser or simpleParser as a configuration option.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Iconv</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;iconv&#39;</span>).<span style="color:#a6e22e">Iconv</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">MailParser</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;mailparser&#39;</span>).<span style="color:#a6e22e">MailParser</span>;
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">parser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MailParser</span>({ <span style="color:#a6e22e">Iconv</span> });
</code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Iconv</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;iconv&#39;</span>).<span style="color:#a6e22e">Iconv</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">simpleParser</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;mailparser&#39;</span>).<span style="color:#a6e22e">simpleParser</span>;
<span style="color:#a6e22e">simpleParser</span>(<span style="color:#e6db74">&#39;rfc822 message&#39;</span>, { <span style="color:#a6e22e">Iconv</span> }, <span style="color:#a6e22e">callback</span>);
</code></pre></div><h2 id="license">License</h2>
<p>Dual licensed under <strong>MIT</strong> or <strong>EUPLv1.1+</strong></p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/extras/smtp-connection/" title="SMTP Connection"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/extras/mailcomposer/" title="Mailcomposer" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1725525815"></script>
    <script src="/js/perfect-scrollbar.min.js?1725525815"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1725525815"></script>
    <script src="/js/jquery.sticky.js?1725525815"></script>
    <script src="/js/featherlight.min.js?1725525815"></script>
    <script src="/js/html5shiv-printshiv.min.js?1725525815"></script>
    <script src="/js/highlight.pack.js?1725525815"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1725525815"></script>
    <script src="/js/learn.js?1725525815"></script>
    <script src="/js/hugo-learn.js?1725525815"></script>

    <link href="/mermaid/mermaid.css?1725525815" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1725525815"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

