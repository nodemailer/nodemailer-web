<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="description" content="Nodemailer is a module for Node.js to send emails">
<meta name="author" content="Andris Reinman">

    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <title>Create plugins :: Nodemailer</title>

    
    <link href="/css/nucleus.css?1621765475" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1621765475" rel="stylesheet">
    <link href="/css/hybrid.css?1621765475" rel="stylesheet">
    <link href="/css/featherlight.min.css?1621765475" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1621765475" rel="stylesheet">
    <link href="/css/auto-complete.css?1621765475" rel="stylesheet">
    <link href="/css/theme.css?1621765475" rel="stylesheet">
    <link href="/css/hugo-theme.css?1621765475" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1621765475" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1621765475"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <style>
    #sidebar #header-wrapper {
        background-color: white;
    }
    #sidebar #header-wrapper a {
        color: #07689f;
    }

    #ads {
         
        max-width: 260px;
         
        margin: 3px auto 10px auto;
         
        font-size: 13px;
        color: #07689f;
    }

    #carbonads * {
  margin: initial;
  padding: initial;
}
#carbonads {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
    Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Helvetica, Arial,
    sans-serif;
}
#carbonads {
  display: flex;
  max-width: 330px;
  background-color: hsl(0, 0%, 98%);
  box-shadow: 0 1px 4px 1px hsla(0, 0%, 0%, 0.1);
  z-index: 100;
}
#carbonads a {
  color: inherit;
  text-decoration: none;
}
#carbonads a:hover {
  color: inherit;
}
#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}
#carbonads .carbon-wrap {
  display: flex;
}
#carbonads .carbon-img {
  display: block;
  margin: 0;
  line-height: 1;
}
#carbonads .carbon-img img {
  display: block;
}
#carbonads .carbon-text {
  font-size: 13px;
  padding: 10px;
  margin-bottom: 16px;
  line-height: 1.5;
  text-align: left;
}
#carbonads .carbon-poweredby {
  display: block;
  padding: 6px 8px;
  background: #f1f1f2;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
  font-size: 8px;
  line-height: 1;
  border-top-left-radius: 3px;
  position: absolute;
  bottom: 0;
  right: 0;
}

    #chapter p {
        text-align: left;
    }

    code {
        line-height: 1.5rem;
    }
</style>

<script>
    var OFID = '5ade1fb4e2982f2638310b10';
</script>
<script src="https://app.outfunnel.com/c.js"></script>


<script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-51322-34"
></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-51322-34');
</script>

  </head>
  <body class="" data-url="/plugins/create/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://nodemailer.com">
  <img src="/nm_logo_200x136.png" alt="Nodemailer" />
</a>

    </div>
    
        <p>
  <a
    href="http://outfunnel.com/?utm_source=nodemailer&amp;utm_campaign=nodemailer&amp;utm_medium=header-link"
    >Powered by <b>Outfunnel</b></a
  >
</p>

    
  </div>

    <div class="highlightable">

    <div id="ads">


<script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYIE27U&placement=nodemailercom" id="_carbonads_js"></script>


    </div>

    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/about/" title="Nodemailer" class="dd-item
        
        
        
        ">
      <a href="/about/">
          <b>1. </b>Nodemailer
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/about/migrate/" title="Migration" class="dd-item ">
        <a href="/about/migrate/">
        Migration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/about/license/" title="License" class="dd-item ">
        <a href="/about/license/">
        License
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/usage/" title="Usage" class="dd-item
        
        
        
        ">
      <a href="/usage/">
          <b>2. </b>Usage
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/usage/why-smtp/" title="SMTP? Say what?" class="dd-item ">
        <a href="/usage/why-smtp/">
        SMTP? Say what?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/using-gmail/" title="Using Gmail" class="dd-item ">
        <a href="/usage/using-gmail/">
        Using Gmail
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/bulk-mail/" title="Delivering bulk mail" class="dd-item ">
        <a href="/usage/bulk-mail/">
        Delivering bulk mail
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/message/" title="Message configuration" class="dd-item
        
        
        
        ">
      <a href="/message/">
          <b>3. </b>Message configuration
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/message/attachments/" title="Attachments" class="dd-item ">
        <a href="/message/attachments/">
        Attachments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/alternatives/" title="Alternatives" class="dd-item ">
        <a href="/message/alternatives/">
        Alternatives
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/addresses/" title="Address object" class="dd-item ">
        <a href="/message/addresses/">
        Address object
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/calendar-events/" title="Calendar events" class="dd-item ">
        <a href="/message/calendar-events/">
        Calendar events
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/embedded-images/" title="Embedded images" class="dd-item ">
        <a href="/message/embedded-images/">
        Embedded images
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/list-headers/" title="List headers" class="dd-item ">
        <a href="/message/list-headers/">
        List headers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/custom-headers/" title="Custom headers" class="dd-item ">
        <a href="/message/custom-headers/">
        Custom headers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/message/custom-source/" title="Custom source" class="dd-item ">
        <a href="/message/custom-source/">
        Custom source
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/smtp/" title="SMTP transport" class="dd-item
        
        
        
        ">
      <a href="/smtp/">
          <b>4. </b>SMTP transport
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/smtp/envelope/" title="SMTP envelope" class="dd-item ">
        <a href="/smtp/envelope/">
        SMTP envelope
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/smtp/pooled/" title="Pooled SMTP" class="dd-item ">
        <a href="/smtp/pooled/">
        Pooled SMTP
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/smtp/testing/" title="Testing SMTP" class="dd-item ">
        <a href="/smtp/testing/">
        Testing SMTP
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/smtp/oauth2/" title="OAuth2" class="dd-item ">
        <a href="/smtp/oauth2/">
        OAuth2
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/smtp/customauth/" title="Custom authentication" class="dd-item ">
        <a href="/smtp/customauth/">
        Custom authentication
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/smtp/proxies/" title="Proxy support" class="dd-item ">
        <a href="/smtp/proxies/">
        Proxy support
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/smtp/dsn/" title="Delivery status notifications" class="dd-item ">
        <a href="/smtp/dsn/">
        Delivery status notifications
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/transports/" title="Other transports" class="dd-item
        
        
        
        ">
      <a href="/transports/">
          <b>5. </b>Other transports
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/transports/sendmail/" title="Sendmail transport" class="dd-item ">
        <a href="/transports/sendmail/">
        Sendmail transport
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/transports/ses/" title="SES transport" class="dd-item ">
        <a href="/transports/ses/">
        SES transport
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/transports/stream/" title="Stream transport" class="dd-item ">
        <a href="/transports/stream/">
        Stream transport
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/plugins/" title="Plugins" class="dd-item
        parent
        
        
        ">
      <a href="/plugins/">
          <b>6. </b>Plugins
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/plugins/create/" title="Create plugins" class="dd-item active">
        <a href="/plugins/create/">
        Create plugins
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/dkim/" title="DKIM" class="dd-item
        
        
        
        ">
      <a href="/dkim/">
          <b>7. </b>DKIM
          
      </a>
      
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/extras/" title="Extra modules" class="dd-item
        
        
        
        ">
      <a href="/extras/">
          <b>8. </b>Extra modules
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/extras/smtp-server/" title="SMTP Server" class="dd-item ">
        <a href="/extras/smtp-server/">
        SMTP Server
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/smtp-connection/" title="SMTP Connection" class="dd-item ">
        <a href="/extras/smtp-connection/">
        SMTP Connection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/mailparser/" title="Mailparser" class="dd-item ">
        <a href="/extras/mailparser/">
        Mailparser
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/mailcomposer/" title="Mailcomposer" class="dd-item ">
        <a href="/extras/mailcomposer/">
        Mailcomposer
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/extras/daemons/" title="Node.js daemons" class="dd-item ">
        <a href="/extras/daemons/">
        Node.js daemons
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/app/" title="NodemailerApp" class="dd-item
        
        
        
        ">
      <a href="/app/">
          <b>9. </b>NodemailerApp
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <div style="text-align: center; margin-bottom:10px;">
    <form
        action="https://www.paypal.com/cgi-bin/webscr"
        method="post"
        target="_top"
    >
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="DB26KWR2BQX5W" />
        <input
            type="image"
            src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif"
            border="0"
            name="submit"
            alt="PayPal - The safer, easier way to pay online!"
            style="display: inline"
        />
        <img
            alt=""
            border="0"
            src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif"
            width="1"
            height="1"
        />
    </form>
</div>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Nodemailer</a> > <a href='/plugins/'>Plugins</a> > Create plugins
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#including-plugins">Including plugins</a></li>
    <li><a href="#plugin-api">Plugin API</a>
      <ul>
        <li><a href="#resolvecontent">resolveContent()</a></li>
        <li><a href="#compile">&lsquo;compile&rsquo;</a></li>
        <li><a href="#stream">&lsquo;stream&rsquo;</a></li>
        <li><a href="#messagetransform">message.transform()</a></li>
        <li><a href="#messagegetaddresses">message.getAddresses()</a></li>
      </ul>
    </li>
    <li><a href="#transports">Transports</a>
      <ul>
        <li><a href="#transportname">transport.name</a></li>
        <li><a href="#transportversion">transport.version</a></li>
        <li><a href="#transportsendmail-callback">transport.send(mail, callback)</a></li>
        <li><a href="#transportclose">transport.close()</a></li>
        <li><a href="#transportisidle">transport.isIdle()</a></li>
        <li><a href="#transport-example">Transport Example</a></li>
      </ul>
    </li>
    <li><a href="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Create plugins</h1>
          

        


<p>There are 3 stages a plugin can hook to:</p>
<ol>
<li><strong>&lsquo;compile&rsquo;</strong> is the step where email data is set but nothing has been done with it yet. At this step you can modify mail options, for example modify <strong>html</strong> content, add new headers etc.</li>
<li><strong>&lsquo;stream&rsquo;</strong> is the step where message tree has been compiled and is ready to be streamed. At this step you can modify the generated MIME tree or add a transform stream that the generated raw email will be piped through before passed to the transport object</li>
<li><strong>Transport</strong> step where the raw email is streamed to destination</li>
</ol>
<h2 id="including-plugins">Including plugins</h2>
<p>&lsquo;compile&rsquo; and &lsquo;stream&rsquo; plugins can be attached with <code>use(plugin)</code> method</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transporter</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">step</span>, <span style="color:#a6e22e">pluginFunc</span>)
</code></pre></div><p>Where</p>
<ul>
<li><strong>transporter</strong> is a transport object created with <strong>createTransport()</strong></li>
<li><strong>step</strong> is a string, either <em>&lsquo;compile&rsquo;</em> or <em>&lsquo;stream&rsquo;</em> that defines when the plugin should be hooked</li>
<li><strong>pluginFunc</strong> is a function that takes two arguments: the mail object and a callback function</li>
</ul>
<h2 id="plugin-api">Plugin API</h2>
<p>All plugins (including transports) get two arguments, the mail object and a callback function.</p>
<p>Mail object that is passed to the plugin function as the first argument is an object with the following properties:</p>
<ul>
<li><strong>data</strong> is the mail data object that is passed to the <strong>sendMail()</strong> method</li>
<li><strong>message</strong> is the MimeNode object of the message. This is available for the &lsquo;stream&rsquo; step and for the transport but not for &lsquo;compile&rsquo;.</li>
<li><strong>resolveContent</strong> is a helper function for converting Nodemailer compatible stream objects into Strings or Buffers</li>
</ul>
<h3 id="resolvecontent">resolveContent()</h3>
<p>If your plugin needs to get the full value of a param, for example the String value for the <strong>html</strong> content, you can use <strong>resolveContent()</strong> to convert Nodemailer compatible content objects to Strings or Buffers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">resolveContent</span>(<span style="color:#a6e22e">obj</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">callback</span>)
</code></pre></div><p>Where</p>
<ul>
<li><strong>obj</strong> is an object that has a property you want to convert to a String or a Buffer</li>
<li><strong>key</strong> is the name of the property you want to convert</li>
<li><strong>callback</strong> is the callback function with <em>(err, value)</em> where <strong>value</strong> is either a String or Buffer, depending on the input</li>
</ul>
<h4 id="example">Example</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">plugin</span>(<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) {
    <span style="color:#75715e">// if mail.data.html is a file or an url, it is returned as a Buffer
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">resolveContent</span>(<span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">data</span>, <span style="color:#e6db74">&#39;html&#39;</span>, (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">html</span>) =&gt; {
        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">err</span>){
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">err</span>);
        }
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;HTML contents: %s&#39;</span>, <span style="color:#a6e22e">html</span>.<span style="color:#a6e22e">toString</span>());
        <span style="color:#a6e22e">callback</span>();
    });
};
</code></pre></div><h3 id="compile">&lsquo;compile&rsquo;</h3>
<p>Compile step plugins get only the <strong>mail.data</strong> object but not <strong>mail.message</strong>. If you need to access the latter as well, use <em>&lsquo;stream&rsquo;</em> step instead.</p>
<p>This is really straightforward, your plugin can modify the <strong>mail.data</strong> object at will and once everything is finished run the callback function. If the callback gets an error object as an argument, then the process is terminated and the error is returned to the <strong>sendMail()</strong> callback.</p>
<h4 id="example-1">Example</h4>
<p>The following plugin checks if <strong>text</strong> value is set and if not converts <strong>html</strong> value by removing all html tags.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transporter</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;compile&#39;</span>, (<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) =&gt; {
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">text</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">html</span>){
        <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">html</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;[^&gt;]*&gt;/g</span>, <span style="color:#e6db74">&#39; &#39;</span>);
    }
    <span style="color:#a6e22e">callback</span>();
});
</code></pre></div><h3 id="stream">&lsquo;stream&rsquo;</h3>
<p>Streaming step is invoked once the message structure is built and ready to be streamed to the transport. Plugin function does get <strong>mail.data</strong> as an argument but it is included just for the reference, modifying it should not change anything (unless the transport requires something from the <strong>mail.data</strong>, for example <strong>mail.data.envelope</strong>).</p>
<p>You can modify the <strong>mail.message</strong> object as you like, the message is not yet streaming anything (message starts streaming when the transport calls <strong>mail.message.createReadStream()</strong>).</p>
<p>In most cases you might be interested in the <strong>message.transform()</strong> method for applying transform streams to the raw message.</p>
<h4 id="example-2">Example</h4>
<p>The following plugin replaces all tabs with spaces in the raw message.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">transformer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> (<span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;stream&#39;</span>).<span style="color:#a6e22e">Transform</span>)();
<span style="color:#a6e22e">transformer</span>.<span style="color:#a6e22e">_transform</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">chunk</span>, <span style="color:#a6e22e">encoding</span>, <span style="color:#a6e22e">done</span>) =&gt; {
    <span style="color:#75715e">// replace all tabs with spaces in the stream chunk
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>){
        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">chunk</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">===</span> <span style="color:#ae81ff">0x09</span>){
            <span style="color:#a6e22e">chunk</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span>;
        }
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">chunk</span>);
    <span style="color:#a6e22e">done</span>();
};

<span style="color:#a6e22e">transporter</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;stream&#39;</span>, (<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) =&gt; {
    <span style="color:#75715e">// apply output transformer to the raw message stream
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">transform</span>(<span style="color:#a6e22e">transformer</span>);
    <span style="color:#a6e22e">callback</span>();
});
</code></pre></div><p>Additionally you might be interested in the <strong>message.getAddresses()</strong> method that returns the contents for all address fields as structured objects.</p>
<h4 id="example-3">Example</h4>
<p>The following plugin prints address information to console.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transporter</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;stream&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) =&gt; {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">addresses</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">getAddresses</span>();
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;From: %s&#39;</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">from</span>));
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;To: %s&#39;</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">to</span>));
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Cc: %s&#39;</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">cc</span>));
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Bcc: %s&#39;</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">bcc</span>));
    <span style="color:#a6e22e">callback</span>();
});
</code></pre></div><h3 id="messagetransform">message.transform()</h3>
<p>If you want to modify the created stream, you can add transform streams that the output will be piped through.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">transform</span>(<span style="color:#a6e22e">transformStream</span>)
</code></pre></div><p>Where</p>
<ul>
<li><strong>transformStream</strong> - <em>Stream</em> or <em>Function</em> Transform stream that the output will go through. If the value is a function the function should return a transform stream object when called.</li>
</ul>
<h3 id="messagegetaddresses">message.getAddresses()</h3>
<p>Returns an address container object. Includes all parsed addresses from <em>From</em>, <em>Sender</em>, <em>To</em>, <em>Cc</em>, <em>Bcc</em> and <em>Reply-To</em> fields. All returned values are arrays, including <code>from</code>.</p>
<p>Possible return values (all arrays in the form of <code>[{name:'', address:''}]</code>):</p>
<ul>
<li><strong>from</strong></li>
<li><strong>sender</strong></li>
<li><strong>&lsquo;reply-to&rsquo;</strong></li>
<li><strong>to</strong></li>
<li><strong>cc</strong></li>
<li><strong>bcc</strong></li>
</ul>
<p>If no addresses were found for a particular field, the field is not set in the response object.</p>
<h2 id="transports">Transports</h2>
<p>Transports are objects that have a method <strong>send()</strong> and properies <strong>name</strong> and <strong>version</strong>. A transport object is passed to the <code>nodemailer.createTransport(transport)</code> method to create the transporter object.</p>
<h3 id="transportname">transport.name</h3>
<p>This is the name of the transport object. For example &lsquo;SMTP&rsquo; or &lsquo;SES&rsquo; etc.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;package.json&#39;</span>).<span style="color:#a6e22e">name</span>;
</code></pre></div><h3 id="transportversion">transport.version</h3>
<p>This should be the transport module version. For example &lsquo;0.1.0&rsquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;package.json&#39;</span>).<span style="color:#a6e22e">version</span>;
</code></pre></div><h3 id="transportsendmail-callback">transport.send(mail, callback)</h3>
<p>This is the method that actually sends out emails. The method is basically the same as &lsquo;stream&rsquo; plugin functions. It gets two arguments: <strong>mail</strong> and a callback. To start streaming the message, create the stream with <strong>mail.message.createReadStream()</strong></p>
<p>Callback function should return an <strong>info</strong> object as the second argument. This info object should contain and <strong>envelope</strong> object with envelope data and a <strong>messageId</strong> value with the Message-Id header (including the surrounding &lt; &amp; &gt; brackets),</p>
<p>The following example pipes the raw stream from Nodemailer to the console.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">send</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) =&gt; {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">createReadStream</span>();
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">envelope</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">getEnvelope</span>();
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">messageId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">messageId</span>();
    <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">pipe</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">stdout</span>);
    <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;end&#39;</span>, <span style="color:#66d9ef">function</span>() {
        <span style="color:#a6e22e">callback</span>(<span style="color:#66d9ef">null</span>, {
            <span style="color:#a6e22e">envelope</span>,
            <span style="color:#a6e22e">messageId</span>
        });
    });
};
</code></pre></div><h3 id="transportclose">transport.close()</h3>
<p>If your transport needs to be closed explicitly, you can implement a <strong>close()</strong> method.</p>
<p>This is purely optional feature and only makes sense in special contexts (eg. closing a SMTP pool).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">close</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">pool</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
};
</code></pre></div><h3 id="transportisidle">transport.isIdle()</h3>
<p>If your transport is able to notify about idling state by issuing <em>&lsquo;idle&rsquo;</em> events then this method should return if the transport is still idling or not.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">idling</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
<span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">isIdle</span> <span style="color:#f92672">=</span> () =&gt; <span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">idling</span>;
<span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">send</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) =&gt; {
    <span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">idling</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    <span style="color:#a6e22e">sendMail</span>(<span style="color:#a6e22e">mail</span>, ()=&gt;{
        <span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">idling</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
        <span style="color:#a6e22e">transport</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;idle&#39;</span>);
    });
};
</code></pre></div><h3 id="transport-example">Transport Example</h3>
<p>This example creates and uses a transport object that pipes the raw message to console</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">transport</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;minimal&#39;</span>,
    <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;0.1.0&#39;</span>,
    <span style="color:#a6e22e">send</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">mail</span>, <span style="color:#a6e22e">callback</span>) =&gt; {
        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mail</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">createReadStream</span>();
        <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">pipe</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">stdout</span>);
        <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;end&#39;</span>, <span style="color:#66d9ef">function</span> () {
            <span style="color:#a6e22e">callback</span>(<span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">true</span>);
        });
    }
};

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">transporter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">nodemailer</span>.<span style="color:#a6e22e">createTransport</span>(<span style="color:#a6e22e">transport</span>);
<span style="color:#a6e22e">transporter</span>.<span style="color:#a6e22e">sendMail</span>({
    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sender&#39;</span>,
    <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;receiver&#39;</span>,
    <span style="color:#a6e22e">subject</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;hello&#39;</span>,
    <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;hello world!&#39;</span>
});
</code></pre></div><h2 id="wrapping-up">Wrapping up</h2>
<p>Once you have a transport object, you can create a mail transporter out of it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">transport</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;some-transport-method&#39;</span>);
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">transporter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">nodemailer</span>.<span style="color:#a6e22e">createTransport</span>(<span style="color:#a6e22e">transport</span>);
<span style="color:#a6e22e">transporter</span>.<span style="color:#a6e22e">sendMail</span>({
    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;...&#39;</span>,
    <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;...&#39;</span>,
    <span style="color:#a6e22e">message</span>
});
</code></pre></div>

<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/plugins/" title="Plugins"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/dkim/" title="DKIM" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1621765475"></script>
    <script src="/js/perfect-scrollbar.min.js?1621765475"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1621765475"></script>
    <script src="/js/jquery.sticky.js?1621765475"></script>
    <script src="/js/featherlight.min.js?1621765475"></script>
    <script src="/js/html5shiv-printshiv.min.js?1621765475"></script>
    <script src="/js/highlight.pack.js?1621765475"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1621765475"></script>
    <script src="/js/learn.js?1621765475"></script>
    <script src="/js/hugo-learn.js?1621765475"></script>

    <link href="/mermaid/mermaid.css?1621765475" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1621765475"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

